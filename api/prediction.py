import sys
import json
import logging
import os

from api.sepsis_predict_rf import rf_predict

here = os.path.dirname(os.path.realpath(__file__))
sys.path.append(os.path.join(here, ".."))

logging.getLogger().setLevel(logging.INFO)

class Prediction(object):
  def __init__(self):
    self._load_model()

  def _load_model(self):
    return 0

  def post(self, body) -> list:
    logging.info(f"{body}")
    result = dict()
    try:
        prediction = rf_predict(body["sepsis_fv"])
        logging.info(f"Predictions:{prediction}")
        result["sepsis_risk"] = prediction.tolist()
        return result, 200
    except Exception as e:
        logging.exception(f'{e}')
        return str(e), 500

  def get(self):
    return 200


class_instance = Prediction()

if __name__=="__main__":
    body = { "fv": "7:1 264:1 303:1 309:1 311:2 312:1 321:2 325:1 327:2 336:1 339:1 346:1 348:1 350:1 354:1 356:1 358:1 359:1 365:1 366:1 370:1 378:1 1202:1 1209:1 1219:2 1224:2 1226:10 1263:1 1264:4260208 1268:1 1271:1240 1272:65904 1280:1 1281:4259840 1282:1 1284:8 1285:5 1286:65536 1287:1 1307:1 1308:4259860 1312:1 1315:348 1316:1 1377:1 1378:4259848 1380:8 1381:65544 1382:1 13424:1 13425:4255360 13426:1 13427:36 13428:3 13429:1 13535:1 13536:4194452 13538:1 13539:48 13540:1 13541:148 13542:1 14986:1 14987:4255396 14993:3920 14994:4 14995:61092 14996:1 15002:1 15003:62 15004:9 15005:65904 15006:1 32516:4194528 32519:1 32523:60832 32524:224 32525:1 32526:1 32527:1 32528:1 32571:1 32573:1 32585:7 32588:1 32590:3 32591:3 32592:2 32593:2 32702:1 32709:1 32712:1 32722:1 32732:1 32737:1 32744:1 32749:1 32773:1 32777:1 32790:1 32794:1 32795:1 32800:1 32802:1 32805:1 32821:1 32826:1 32842:1 32853:1 32857:1 32866:1 32870:1 32871:1 32874:1 32875:1 32876:1 32877:1 32879:1 32881:1 32883:1 32885:1 32887:1 32888:1 33044:1 33045:1 33046:1 33060:1 33061:1 33062:1 33063:1 33064:1 33065:1 33066:1 33067:1 33068:1 33069:1 33158:2 33159:2 33160:1 33161:1 33174:1 33177:1 33180:1 33194:1 33199:1 33204:1 33229:1 33231:1 33242:1 33246:1 33247:1 33251:1 33252:1 33254:1 33266:1 33270:1 33280:1 33285:1 33296:1 33299:1 33307:1 33310:1 33359:1 33360:1 62894:1 62900:1 62910:2 -1:54"}
    rd = class_instance.post(body)
    print(rd)
